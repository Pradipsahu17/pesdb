-- FUNCTION: atm.post_atm_transaction(character varying, character varying, money, character varying)

-- DROP FUNCTION IF EXISTS atm.post_atm_transaction(character varying, character varying, money, character varying);

CREATE OR REPLACE FUNCTION atm.post_atm_transaction(
	from_acc_ character varying,
	atmterminal_identification_ character varying,
	amount_ money,
	tran_type_ character varying,
	bin_id_ character varying)
    RETURNS bigint
    LANGUAGE 'plpgsql'
    COST 100
    VOLATILE PARALLEL UNSAFE
AS $BODY$
DECLARE _trans_id		bigint;

BEGIN	

-- SCT VOSTRO A/C 99-58-00000066
-- SCT OWNERSHIP CHARGE A/C 99-58-00000067
-- SCT ATM CHARGE A/C 99-58-00000068  Issuer (Cooperative)  and remaining to vostro
-- ATM ANNUAL CHARGE A/C 99-58-00000069

IF tran_type_ ='on_us' THEN
SELECT * FROM atm.post_atm_transaction_on_us(from_acc_, atmterminal_identification_, amount_, tran_type_,$5) INTO _trans_id;

elsif tran_type_ ='off_us' THEN

	SELECT * FROM atm.post_atm_transaction_off_us(from_acc_, atmterminal_identification_, amount_, tran_type_,$5) INTO _trans_id;

elsif tran_type_ = 'off_us_upi' THEN			

	SELECT * FROM atm.post_atm_transaction_off_us_upi(from_acc_, atmterminal_identification_, amount_, tran_type_,$5) INTO _trans_id;	

elsif tran_type_ = 'loro' THEN			

	SELECT * FROM atm.post_atm_transaction_loro(atmterminal_identification_, amount_, tran_type_) INTO _trans_id;	

elseif tran_type_ = 'pos' THEN

SELECT * FROM atm.post_pos_transaction(from_acc_, $2, amount_, tran_type_) INTO _trans_id;		

else

END IF;

--	SELECT * FROM atm.post_atm_transaction('01-NS-2188', '1234abcd', '5000', 'on_us','474842')

--  SELECT *  FROM atm.atm_booth_setup  

--	insert into atm.atm_booth_setup(atm_booth_setup_id, atmterminal_identification, gl_account_id, is_active, audit_user_id) select 1,'1234abcd',89,true,1
 
 RETURN(SELECT _trans_id);
select * from deposit.account_holders limit 60
END
$BODY$;

ALTER FUNCTION atm.post_atm_transaction(character varying, character varying, money, character varying)
    OWNER TO postgres;
